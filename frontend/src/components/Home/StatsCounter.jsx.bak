import React, { useState, useEffect, useRef } from 'react';
import { motion } from 'framer-motion';

const STATS = [
  { label: 'Jugadores Activos', target: 15000, suffix: '+', icon: 'bx-user' },
  { label: 'Torneos Completados', target: 320, suffix: '+', icon: 'bx-trophy' },
  { label: 'Equipos Creados', target: 1200, suffix: '+', icon: 'bx-group' },
  { label: 'Juegos Soportados', target: 25, suffix: '+', icon: 'bx-joystick' },
];

// Hook para animar un nÃºmero
const useCountUp = (target, duration = 2000, shouldStart = false) => {
  const [count, setCount] = useState(0);

  useEffect(() => {
    if (!shouldStart) return;
    let start = 0;
    const increment = target / (duration / 16);
    const timer = setInterval(() => {
      start += increment;
      if (start >= target) {
        setCount(target);
        clearInterval(timer);
      } else {
        setCount(Math.floor(start));
      }
    }, 16);
    return () => clearInterval(timer);
  }, [target, duration, shouldStart]);

  return count;
};

const StatItem = ({ stat, inView }) => {
  const count = useCountUp(stat.target, 2000, inView);

  return (
    <div className="text-center group">
      <div className="w-16 h-16 mx-auto mb-4 rounded-2xl bg-[var(--primary)]/10 border border-[var(--primary)]/20 flex items-center justify-center group-hover:bg-[var(--primary)]/20 group-hover:border-[var(--primary)]/40 transition-all duration-300">
        <i className={`bx ${stat.icon} text-3xl text-[var(--primary)]`}></i>
      </div>
      <div className="text-4xl md:text-5xl font-bold text-[var(--text-main)] mb-2 tabular-nums">
        {count.toLocaleString()}{stat.suffix}
      </div>
      <div className="text-[var(--text-muted)] text-sm uppercase tracking-wider font-medium">
        {stat.label}
      </div>
    </div>
  );
};

const StatsCounter = () => {
  const [inView, setInView] = useState(false);
  const sectionRef = useRef(null);

  useEffect(() => {
    const observer = new IntersectionObserver(
      ([entry]) => {
        if (entry.isIntersecting) {
          setInView(true);
          observer.disconnect();
        }
      },
      { threshold: 0.3 }
    );

    if (sectionRef.current) observer.observe(sectionRef.current);
    return () => observer.disconnect();
  }, []);

  return (
    <section
      ref={sectionRef}
      className="relative py-20 px-6 bg-[var(--bg-card)] border-y border-white/5"
    >
      {/* LÃ­nea decorativa superior */}
      <div className="absolute top-0 left-1/2 -translate-x-1/2 w-24 h-[2px] bg-gradient-to-r from-transparent via-[#8EDB15] to-transparent" />

      <motion.div
        initial={{ opacity: 0, y: 40 }}
        whileInView={{ opacity: 1, y: 0 }}
        viewport={{ once: true }}
        transition={{ duration: 0.6 }}
        className="max-w-5xl mx-auto grid grid-cols-2 md:grid-cols-4 gap-12"
      >
        {STATS.map((stat) => (
          <StatItem key={stat.label} stat={stat} inView={inView} />
        ))}
      </motion.div>
    </section>
  );
};

export default StatsCounter;
